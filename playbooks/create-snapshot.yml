---
# AAP Job Template Playbook: Create VM Snapshot
# Simple playbook for Ansible Automation Platform

- name: Create KubeVirt VM Snapshot
  hosts: localhost
  gather_facts: yes
  
  tasks:
    - name: Generate snapshot name if not provided
      ansible.builtin.set_fact:
        snapshot_name: "aap-snapshot-{{ ansible_date_time.epoch }}"
      when: (snapshot_name is not defined) or (snapshot_name == '')
    
    - name: Display job information
      ansible.builtin.debug:
        msg:
          - "VM: {{ vm_name }}"
          - "Namespace: {{ vm_namespace }}"
          - "Snapshot: {{ snapshot_name }}"

    - name: Create KubeVirt snapshot
      ansible.builtin.include_role:
        name: ../roles/ocp_virt_snapshot

    - name: Display result
      ansible.builtin.debug:
        msg:
          - "Snapshot created: {{ snapshot_info.snapshot_name }}"
          - "Status: {{ snapshot_info.status }}"
      when: snapshot_info is defined
